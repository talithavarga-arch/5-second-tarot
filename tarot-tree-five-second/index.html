<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Tarot Tree Five Second Tarot Reading</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card-container {
            perspective: 1000px;
        }
        .card {
            transform-style: preserve-3d;
            transition: transform 0.8s;
            position: relative;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .card-face-back {
            transform: rotateY(180deg);
        }
        .lora-font {
            font-family: 'Lora', serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto bg-gray-800 bg-opacity-60 backdrop-blur-md rounded-2xl shadow-2xl p-6 md:p-8">
        
        <!-- App Header -->
        <div class="text-center mb-6">
            <!-- BRANDING: You can replace this with your own logo SVG or image -->
            <svg class="w-12 h-12 mx-auto mb-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 6.5a1 1 0 11-2 0 1 1 0 012 0z"></path>
            </svg>
            <h1 class="text-3xl md:text-4xl font-bold lora-font">The Tarot Tree</h1>
            <p class="text-gray-400 mt-2">Your five-second tarot reading.</p>
        </div>

        <!-- Input Section -->
        <div class="space-y-4">
            <textarea id="questionInput" class="w-full h-24 p-3 bg-gray-700 border-2 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition" placeholder="What do you seek clarity on? e.g., 'What should I focus on in my career right now?'"></textarea>
            <button id="getReadingBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 shadow-lg">
                Get My Free Reading
            </button>
        </div>

        <!-- Results Section -->
        <div id="results" class="mt-8 hidden">
            <!-- Loading Spinner -->
            <div id="loadingSpinner" class="text-center hidden">
                <svg class="animate-spin h-8 w-8 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-2 text-gray-400">Consulting the cards...</p>
            </div>

            <!-- Card Display -->
            <div id="cardDisplay" class="grid grid-cols-1 sm:grid-cols-3 gap-4 md:gap-6 mb-6">
                <!-- Cards will be injected here by JavaScript -->
            </div>

            <!-- Interpretation -->
            <div id="interpretation" class="bg-gray-900 bg-opacity-50 p-6 rounded-lg hidden">
                <h2 class="text-2xl font-bold mb-4 lora-font">Your Reading:</h2>
                <div id="interpretationText" class="text-gray-300 space-y-4 leading-relaxed"></div>
            </div>
        </div>
    </div>

<script>
    // --- DATA: The 78 Tarot Cards with Rider-Waite Imagery ---
    const tarotDeck = [
        { name: "The Fool", meaning: "Beginnings, innocence, spontaneity, a free spirit", image: "https://www.sacred-texts.com/tarot/pkt/img/ar00.jpg" },
        { name: "The Magician", meaning: "Manifestation, resourcefulness, power, inspired action", image: "https://www.sacred-texts.com/tarot/pkt/img/ar01.jpg" },
        { name: "The High Priestess", meaning: "Intuition, sacred knowledge, divine feminine, the subconscious mind", image: "https://www.sacred-texts.com/tarot/pkt/img/ar02.jpg" },
        { name: "The Empress", meaning: "Femininity, beauty, nature, nurturing, abundance", image: "https://www.sacred-texts.com/tarot/pkt/img/ar03.jpg" },
        { name: "The Emperor", meaning: "Authority, establishment, structure, a father figure", image: "https://www.sacred-texts.com/tarot/pkt/img/ar04.jpg" },
        { name: "The Hierophant", meaning: "Spiritual wisdom, religious beliefs, conformity, tradition, institutions", image: "https://www.sacred-texts.com/tarot/pkt/img/ar05.jpg" },
        { name: "The Lovers", meaning: "Love, harmony, relationships, values alignment, choices", image: "https://www.sacred-texts.com/tarot/pkt/img/ar06.jpg" },
        { name: "The Chariot", meaning: "Control, willpower, success, action, determination", image: "https://www.sacred-texts.com/tarot/pkt/img/ar07.jpg" },
        { name: "Strength", meaning: "Strength, courage, persuasion, influence, compassion", image: "https://www.sacred-texts.com/tarot/pkt/img/ar08.jpg" },
        { name: "The Hermit", meaning: "Soul-searching, introspection, being alone, inner guidance", image: "https://www.sacred-texts.com/tarot/pkt/img/ar09.jpg" },
        { name: "Wheel of Fortune", meaning: "Good luck, karma, life cycles, destiny, a turning point", image: "https://www.sacred-texts.com/tarot/pkt/img/ar10.jpg" },
        { name: "Justice", meaning: "Justice, fairness, truth, cause and effect, law", image: "https://www.sacred-texts.com/tarot/pkt/img/ar11.jpg" },
        { name: "The Hanged Man", meaning: "Pause, surrender, letting go, new perspectives", image: "https://www.sacred-texts.com/tarot/pkt/img/ar12.jpg" },
        { name: "Death", meaning: "Endings, change, transformation, transition", image: "https://www.sacred-texts.com/tarot/pkt/img/ar13.jpg" },
        { name: "Temperance", meaning: "Balance, moderation, patience, purpose", image: "https://www.sacred-texts.com/tarot/pkt/img/ar14.jpg" },
        { name: "The Devil", meaning: "Shadow self, attachment, addiction, restriction, sexuality", image: "https://www.sacred-texts.com/tarot/pkt/img/ar15.jpg" },
        { name: "The Tower", meaning: "Sudden change, upheaval, chaos, revelation, awakening", image: "https://www.sacred-texts.com/tarot/pkt/img/ar16.jpg" },
        { name: "The Star", meaning: "Hope, faith, purpose, renewal, spirituality", image: "https://www.sacred-texts.com/tarot/pkt/img/ar17.jpg" },
        { name: "The Moon", meaning: "Illusion, fear, anxiety, subconscious, intuition", image: "https://www.sacred-texts.com/tarot/pkt/img/ar18.jpg" },
        { name: "The Sun", meaning: "Positivity, fun, warmth, success, vitality", image: "https://www.sacred-texts.com/tarot/pkt/img/ar19.jpg" },
        { name: "Judgement", meaning: "Judgement, rebirth, inner calling, absolution", image: "https://www.sacred-texts.com/tarot/pkt/img/ar20.jpg" },
        { name: "The World", meaning: "Completion, integration, accomplishment, travel", image: "https://www.sacred-texts.com/tarot/pkt/img/ar21.jpg" },
        { name: "Ace of Wands", meaning: "Inspiration, new opportunities, growth, potential", image: "https://www.sacred-texts.com/tarot/pkt/img/waac.jpg" },
        { name: "Two of Wands", meaning: "Future planning, progress, decisions, discovery", image: "https://www.sacred-texts.com/tarot/pkt/img/watu.jpg" },
        { name: "Three of Wands", meaning: "Preparation, foresight, enterprise, expansion", image: "https://www.sacred-texts.com/tarot/pkt/img/watr.jpg" },
        { name: "Four of Wands", meaning: "Celebration, joy, harmony, relaxation, homecoming", image: "https://www.sacred-texts.com/tarot/pkt/img/wafo.jpg" },
        { name: "Five of Wands", meaning: "Conflict, disagreements, competition, tension, diversity", image: "https://www.sacred-texts.com/tarot/pkt/img/wafi.jpg" },
        { name: "Six of Wands", meaning: "Public recognition, victory, progress, self-confidence", image: "https://www.sacred-texts.com/tarot/pkt/img/wasi.jpg" },
        { name: "Seven of Wands", meaning: "Challenge, competition, perseverance, protection", image: "https://www.sacred-texts.com/tarot/pkt/img/wase.jpg" },
        { name: "Eight of Wands", meaning: "Speed, action, air travel, movement, swift change", image: "https://www.sacred-texts.com/tarot/pkt/img/waei.jpg" },
        { name: "Nine of Wands", meaning: "Resilience, courage, persistence, test of faith, boundaries", image: "https://www.sacred-texts.com/tarot/pkt/img/wani.jpg" },
        { name: "Ten of Wands", meaning: "Burden, extra responsibility, hard work, completion", image: "https://www.sacred-texts.com/tarot/pkt/img/wate.jpg" },
        { name: "Page of Wands", meaning: "Enthusiasm, exploration, discovery, free spirit", image: "https://www.sacred-texts.com/tarot/pkt/img/wapa.jpg" },
        { name: "Knight of Wands", meaning: "Energy, passion, inspired action, adventure, impulsiveness", image: "https://www.sacred-texts.com/tarot/pkt/img/wakn.jpg" },
        { name: "Queen of Wands", meaning: "Courage, confidence, independence, social butterfly, determination", image: "https://www.sacred-texts.com/tarot/pkt/img/waqu.jpg" },
        { name: "King of Wands", meaning: "Natural-born leader, vision, entrepreneur, honour", image: "https://www.sacred-texts.com/tarot/pkt/img/waki.jpg" },
        { name: "Ace of Cups", meaning: "Love, new relationships, compassion, creativity", image: "https://www.sacred-texts.com/tarot/pkt/img/cuac.jpg" },
        { name: "Two of Cups", meaning: "Unified love, partnership, mutual attraction", image: "https://www.sacred-texts.com/tarot/pkt/img/cutu.jpg" },
        { name: "Three of Cups", meaning: "Celebration, friendship, creativity, collaborations", image: "https://www.sacred-texts.com/tarot/pkt/img/cutr.jpg" },
        { name: "Four of Cups", meaning: "Meditation, contemplation, apathy, re-evaluation", image: "https://www.sacred-texts.com/tarot/pkt/img/cufo.jpg" },
        { name: "Five of Cups", meaning: "Regret, failure, disappointment, pessimism", image: "https://www.sacred-texts.com/tarot/pkt/img/cufi.jpg" },
        { name: "Six of Cups", meaning: "Revisiting the past, childhood memories, innocence, joy", image: "https://www.sacred-texts.com/tarot/pkt/img/cusi.jpg" },
        { name: "Seven of Cups", meaning: "Opportunities, choices, wishful thinking, illusion", image: "https://www.sacred-texts.com/tarot/pkt/img/cuse.jpg" },
        { name: "Eight of Cups", meaning: "Disappointment, abandonment, withdrawal, escapism", image: "https://www.sacred-texts.com/tarot/pkt/img/cuei.jpg" },
        { name: "Nine of Cups", meaning: "Contentment, satisfaction, gratitude, wish come true", image: "https://www.sacred-texts.com/tarot/pkt/img/cuni.jpg" },
        { name: "Ten of Cups", meaning: "Divine love, blissful relationships, harmony, alignment", image: "https://www.sacred-texts.com/tarot/pkt/img/cute.jpg" },
        { name: "Page of Cups", meaning: "Creative opportunities, intuitive messages, curiosity, possibility", image: "https://www.sacred-texts.com/tarot/pkt/img/cupa.jpg" },
        { name: "Knight of Cups", meaning: "Creativity, romance, charm, imagination, beauty", image: "https://www.sacred-texts.com/tarot/pkt/img/cukn.jpg" },
        { name: "Queen of Cups", meaning: "Compassionate, caring, emotionally stable, intuitive, in flow", image: "https://www.sacred-texts.com/tarot/pkt/img/cuqu.jpg" },
        { name: "King of Cups", meaning: "Emotionally balanced, compassionate, diplomatic", image: "https://www.sacred-texts.com/tarot/pkt/img/cuki.jpg" },
        { name: "Ace of Swords", meaning: "Breakthroughs, new ideas, mental clarity, success", image: "https://www.sacred-texts.com/tarot/pkt/img/swac.jpg" },
        { name: "Two of Swords", meaning: "Difficult choices, indecision, stalemate, blocked emotions", image: "https://www.sacred-texts.com/tarot/pkt/img/swtu.jpg" },
        { name: "Three of Swords", meaning: "Heartbreak, emotional pain, sorrow, grief, hurt", image: "https://www.sacred-texts.com/tarot/pkt/img/swtr.jpg" },
        { name: "Four of Swords", meaning: "Rest, relaxation, meditation, contemplation, recuperation", image: "https://www.sacred-texts.com/tarot/pkt/img/swfo.jpg" },
        { name: "Five of Swords", meaning: "Conflict, tension, loss, defeat, win at all costs", image: "https://www.sacred-texts.com/tarot/pkt/img/swfi.jpg" },
        { name: "Six of Swords", meaning: "Transition, change, rite of passage, releasing baggage", image: "https://www.sacred-texts.com/tarot/pkt/img/swsi.jpg" },
        { name: "Seven of Swords", meaning: "Betrayal, deception, getting away with something, acting strategically", image: "https://www.sacred-texts.com/tarot/pkt/img/swse.jpg" },
        { name: "Eight of Swords", meaning: "Negative thoughts, self-imposed restriction, imprisonment, victim mentality", image: "https://www.sacred-texts.com/tarot/pkt/img/swei.jpg" },
        { name: "Nine of Swords", meaning: "Anxiety, worry, fear, depression, nightmares", image: "https://www.sacred-texts.com/tarot/pkt/img/swni.jpg" },
        { name: "Ten of Swords", meaning: "Painful endings, deep wounds, betrayal, loss, crisis", image: "https://www.sacred-texts.com/tarot/pkt/img/swte.jpg" },
        { name: "Page of Swords", meaning: "New ideas, curiosity, thirst for knowledge, new ways of communicating", image: "https://www.sacred-texts.com/tarot/pkt/img/swpa.jpg" },
        { name: "Knight of Swords", meaning: "Ambitious, action-oriented, driven to succeed, fast-thinking", image: "https://www.sacred-texts.com/tarot/pkt/img/swkn.jpg" },
        { name: "Queen of Swords", meaning: "Independent, unbiased judgement, clear boundaries, direct communication", image: "https://www.sacred-texts.com/tarot/pkt/img/swqu.jpg" },
        { name: "King of Swords", meaning: "Mental clarity, intellectual power, authority, truth", image: "https://www.sacred-texts.com/tarot/pkt/img/swki.jpg" },
        { name: "Ace of Pentacles", meaning: "A new financial or career opportunity, manifestation, abundance", image: "https://www.sacred-texts.com/tarot/pkt/img/peac.jpg" },
        { name: "Two of Pentacles", meaning: "Multiple priorities, time management, prioritisation, adaptability", image: "https://www.sacred-texts.com/tarot/pkt/img/petu.jpg" },
        { name: "Three of Pentacles", meaning: "Teamwork, collaboration, learning, implementation", image: "https://www.sacred-texts.com/tarot/pkt/img/petr.jpg" },
        { name: "Four of Pentacles", meaning: "Saving money, security, conservatism, scarcity, control", image: "https://www.sacred-texts.com/tarot/pkt/img/pefo.jpg" },
        { name: "Five of Pentacles", meaning: "Financial loss, poverty, lack mindset, isolation, worry", image: "https://www.sacred-texts.com/tarot/pkt/img/pefi.jpg" },
        { name: "Six of Pentacles", meaning: "Giving, receiving, sharing wealth, generosity, charity", image: "https://www.sacred-texts.com/tarot/pkt/img/pesi.jpg" },
        { name: "Seven of Pentacles", meaning: "Long-term view, sustainable results, perseverance, investment", image: "https://www.sacred-texts.com/tarot/pkt/img/pese.jpg" },
        { name: "Eight of Pentacles", meaning: "Apprenticeship, repetitive tasks, mastery, skill development", image: "https://www.sacred-texts.com/tarot/pkt/img/peei.jpg" },
        { name: "Nine of Pentacles", meaning: "Abundance, luxury, self-sufficiency, financial independence", image: "https://www.sacred-texts.com/tarot/pkt/img/peni.jpg" },
        { name: "Ten of Pentacles", meaning: "Wealth, financial security, family, long-term success, contribution", image: "https://www.sacred-texts.com/tarot/pkt/img/pete.jpg" },
        { name: "Page of Pentacles", meaning: "Manifestation, financial opportunity, skill development", image: "https://www.sacred-texts.com/tarot/pkt/img/pepa.jpg" },
        { name: "Knight of Pentacles", meaning: "Hard work, productivity, routine, conservatism", image: "https://www.sacred-texts.com/tarot/pkt/img/pekn.jpg" },
        { name: "Queen of Pentacles", meaning: "Nurturing, practical, providing financially, a working parent", image: "https://www.sacred-texts.com/tarot/pkt/img/pequ.jpg" },
        { name: "King of Pentacles", meaning: "Wealth, business, leadership, security, discipline, abundance", image: "https://www.sacred-texts.com/tarot/pkt/img/peki.jpg" }
    ];

    // --- DOM Elements ---
    const getReadingBtn = document.getElementById('getReadingBtn');
    const questionInput = document.getElementById('questionInput');
    const resultsDiv = document.getElementById('results');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const cardDisplay = document.getElementById('cardDisplay');
    const interpretationDiv = document.getElementById('interpretation');
    const interpretationText = document.getElementById('interpretationText');
    
    // --- App Logic ---
    getReadingBtn.addEventListener('click', getReading);

    async function getReading() {
        const question = questionInput.value.trim();
        if (!question) {
            // Simple validation feedback
            questionInput.classList.add('border-red-500', 'animate-pulse');
            questionInput.placeholder = "Please enter a question first!";
            setTimeout(() => {
                questionInput.classList.remove('border-red-500', 'animate-pulse');
                questionInput.placeholder = "What do you seek clarity on? e.g., 'What should I focus on in my career right now?'";
            }, 3000);
            return;
        }

        // 1. Reset UI and show loading state
        resultsDiv.style.display = 'block';
        loadingSpinner.style.display = 'block';
        cardDisplay.innerHTML = '';
        interpretationDiv.style.display = 'none';
        interpretationText.innerHTML = '';
        getReadingBtn.disabled = true;
        getReadingBtn.textContent = 'Reading...';


        // 2. Randomly select 3 unique cards
        const selectedCards = [];
        const deckCopy = [...tarotDeck];
        for (let i = 0; i < 3; i++) {
            const randomIndex = Math.floor(Math.random() * deckCopy.length);
            selectedCards.push(deckCopy.splice(randomIndex, 1)[0]);
        }
        
        // 3. Display card backs
        displayCardBacks(selectedCards);

        // 4. Construct the prompt for the AI
        const prompt = `
            You are an insightful, wise, and empathetic tarot reader.
            A user has asked the following question: "${question}"
            They have drawn three cards in a "Past, Present, Future" spread.

            Here are the cards and their traditional meanings:
            1. Past: ${selectedCards[0].name} - Meaning: ${selectedCards[0].meaning}
            2. Present: ${selectedCards[1].name} - Meaning: ${selectedCards[1].meaning}
            3. Future: ${selectedCards[2].name} - Meaning: ${selectedCards[2].meaning}

            Please provide a helpful, encouraging, and easy-to-understand interpretation that weaves together the meanings of these three cards in the context of the user's question. Address the user's question directly. Structure the reading as a single, flowing narrative, not a list. Start the reading directly without any pre-amble like "Here is your reading...". Format the response in paragraphs.
        `;

        try {
            // 5. Call the Gemini API
            // Replace callGeminiAPI with:
async function callGeminiAPI(promptText) {
  const r = await fetch("/api/gemini", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ prompt: promptText })
  });
  if (!r.ok) throw new Error(await r.text());
  const data = await r.json();
  const text = data?.candidates?.[0]?.content?.parts?.[0]?.text;
  return text || "Could not generate an interpretation at this time. Please try again.";
}
            // 6. Flip cards and display the interpretation
            flipCards(selectedCards);
            setTimeout(() => {
                 loadingSpinner.style.display = 'none';
                 interpretationText.innerHTML = interpretation.replace(/\n/g, '<br>');
                 interpretationDiv.style.display = 'block';
            }, 800); // Wait for card flip animation

        } catch (error) {
            console.error("Error fetching from Gemini API:", error);
            loadingSpinner.style.display = 'none';
            interpretationText.innerHTML = `<p class="text-red-400">Sorry, I was unable to connect with the cards at this moment. Please try again later.</p>`;
            interpretationDiv.style.display = 'block';
        } finally {
            getReadingBtn.disabled = false;
            getReadingBtn.textContent = 'Get My Free Reading';
        }
    }

    function displayCardBacks(cards) {
        cards.forEach((card, index) => {
            const position = ['Past', 'Present', 'Future'][index];
            const cardElement = document.createElement('div');
            // Increased height for better card aspect ratio
            cardElement.className = 'card-container h-72';
            cardElement.innerHTML = `
                <div class="card w-full h-full" id="card-${index}">
                    <div class="card-face w-full h-full flex flex-col items-center justify-center bg-purple-900 rounded-lg border-2 border-purple-400 p-2">
                        <div class="w-16 h-16 border-2 border-purple-300 rounded-full flex items-center justify-center">
                            <svg class="w-8 h-8 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        </div>
                    </div>
                    <div class="card-face card-face-back w-full h-full rounded-lg bg-gray-700 overflow-hidden relative border-2 border-gray-500">
                        <img src="${card.image}" alt="${card.name}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML = '<div class=\'w-full h-full flex flex-col items-center justify-center p-2 text-center\'><h3 class=\'font-bold text-sm lora-font\'>${card.name}</h3><p class=\'text-xs text-gray-400 mt-1\'>Image not found</p></div>'">
                        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 p-2 text-center backdrop-blur-sm">
                            <h3 class="font-bold text-sm text-white lora-font">${card.name}</h3>
                            <p class="text-xs text-gray-300">${position}</p>
                        </div>
                    </div>
                </div>
            `;
            cardDisplay.appendChild(cardElement);
        });
    }

    function flipCards(cards) {
        cards.forEach((card, index) => {
            setTimeout(() => {
                const cardEl = document.getElementById(`card-${index}`);
                if (cardEl) cardEl.classList.add('is-flipped');
            }, index * 300); // Stagger the flip animation
        });
    }

    async function callGeminiAPI(promptText) {
        const apiKey = ""; // IMPORTANT: Leave blank in client; use a serverless proxy in production.
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const payload = {
            contents: [{ parts: [{ text: promptText }]}],
        };

        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            const errorBody = await response.text();
            throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorBody}`);
        }

        const data = await response.json();
        
        if (data.candidates && data.candidates.length > 0 && data.candidates[0].content.parts.length > 0) {
            return data.candidates[0].content.parts[0].text;
        } else {
            const reason = data.candidates?.[0]?.finishReason;
            if (reason === 'SAFETY') {
                return "The interpretation for this combination of cards and your question could not be generated due to safety filters. Please try rephrasing your question or ask another one.";
            }
            return "Could not generate an interpretation at this time. Please try again.";
        }
    }
</script>
</body>
</html>
